import React, { Component } from "react";
import LoginImage from "../../Login/LoginImage.js";
import createAcoountService from "../../services/createAcountService";
import { messagePopup } from "../../services/messagePopupService";
import {BackdropLoader} from "../../services/loader";
import "./CreateAccount.css";

class EmailVerificationCode extends Component {
  state = {
    email: '',
    loader: false,
    encryptedEmail: ""
  };

  componentDidMount() {
    const email = new URLSearchParams(this.props.location.search).get('email')
    if(email){
      const finalString = email
      ? Array.from(email)
          .map((char, charIndex) => {
            return charIndex > 1 &&
              charIndex < email.indexOf("@") - 1
              ? "*"
              : char;
          })
          .join("")
      : "";
     this.setState({ encryptedEmail: finalString,email});
    }
    
  }

  handleResend = () => {
    this.setState({ loader: true });
    createAcoountService
      .resendEmail(this.state.email) //.then(resp=>resp.json())
      .then(emailResp => {
        this.setState({ loader: false });
        messagePopup(
          "",
          "Verification link resend to registered email",
          "success"
        );
      })
      .catch(ex => {
        this.setState({ loader: false });
      });
  };

  emailVerification = () => {
    this.props.history.push("/emailVerification");
  };
  render() {
    return (
      <div className="EmailVerificationSection CompanySection">
        <BackdropLoader open={this.state.loader} />
        <LoginImage />
        <div className="emailverificationSection">
          <div className="emailverifyfield">
            <h2>VERIFY EMAIL ADDRESS</h2>
            <span className="mailIcon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                // xmlns:xlink="http://www.w3.org/1999/xlink"
                width="101"
                height="109.75"
                viewBox="0 0 101 109.75"
              >
                <defs>
                  <filter
                    id="Ellipse_8"
                    x="0"
                    y="91.75"
                    width="101"
                    height="18"
                    filterUnits="userSpaceOnUse"
                  >
                    <feOffset input="SourceAlpha" />
                    <feGaussianBlur stdDeviation="2.5" result="blur" />
                    <feFlood />
                    <feComposite operator="in" in2="blur" />
                    <feComposite in="SourceGraphic" />
                  </filter>
                </defs>
                <g
                  id="Group_1172"
                  data-name="Group 1172"
                  transform="translate(-1242.5 -331.75)"
                >
                  <g
                    transform="matrix(1, 0, 0, 1, 1242.5, 331.75)"
                    filter="url(#Ellipse_8)"
                  >
                    <ellipse
                      id="Ellipse_8-2"
                      data-name="Ellipse 8"
                      cx="43"
                      cy="1.5"
                      rx="43"
                      ry="1.5"
                      transform="translate(7.5 99.25)"
                      fill="#9f9f9f"
                      opacity="0.3"
                    />
                  </g>
                  <path
                    id="Icon_awesome-envelope-open"
                    data-name="Icon awesome-envelope-open"
                    d="M74.2,67.248A6.957,6.957,0,0,1,67.248,74.2H6.957A6.957,6.957,0,0,1,0,67.248V29.091a6.957,6.957,0,0,1,2.665-5.475c3.611-2.83,6.595-5.126,23.8-17.611C28.9,4.228,33.74-.05,37.1,0c3.362-.051,8.2,4.228,10.64,6,17.2,12.484,20.189,14.782,23.8,17.611A6.957,6.957,0,0,1,74.2,29.091ZM64.688,38.754a1.159,1.159,0,0,0-1.643-.276c-3.311,2.445-8.038,5.9-15.3,11.171-2.438,1.778-7.277,6.055-10.64,6-3.364.05-8.2-4.224-10.64-6-7.263-5.271-11.991-8.725-15.3-11.171a1.159,1.159,0,0,0-1.643.276L8.2,40.666a1.159,1.159,0,0,0,.267,1.589c3.317,2.449,8.037,5.9,15.262,11.141,2.938,2.142,8.192,6.93,13.372,6.895,5.178.035,10.429-4.75,13.372-6.895C57.7,48.153,62.419,44.7,65.736,42.256A1.159,1.159,0,0,0,66,40.666l-1.315-1.913Z"
                    transform="translate(1256 344.397)"
                    fill="#304ffe"
                  />
                  <g
                    id="Icon_awesome-comment-dots"
                    data-name="Icon awesome-comment-dots"
                    transform="translate(1300.8 334.5)"
                    fill="#00b8fe"
                  >
                    <path
                      d="M 0.5624966025352478 36.25 C -0.6575033664703369 36.25 -1.759373426437378 35.52640151977539 -2.24466347694397 34.40653991699219 C -2.734952926635742 33.27501678466797 -2.50507926940918 31.97077751159668 -1.659304976463318 31.08047485351563 C -1.07308292388916 30.44946098327637 0.3681192696094513 28.63480758666992 1.177938103675842 26.67132949829102 C 0.1883133500814438 25.48824501037598 -0.6150003671646118 24.20911407470703 -1.218653321266174 22.85321998596191 C -2.068893432617188 20.94342994689941 -2.500003337860107 18.93206977844238 -2.500003337860107 16.875 C -2.500003337860107 14.49433040618896 -1.929123401641846 12.1904296875 -0.803213357925415 10.02729988098145 C 0.2619766294956207 7.98084020614624 1.775466680526733 6.152339935302734 3.695236682891846 4.592589855194092 C 7.538836479187012 1.469799995422363 12.61902618408203 -0.25 17.99999618530273 -0.25 C 23.38096618652344 -0.25 28.46116638183594 1.469799995422363 32.30475616455078 4.592589855194092 C 34.22452545166016 6.152339935302734 35.7380256652832 7.98084020614624 36.80320739746094 10.02729988098145 C 37.92911529541016 12.1904296875 38.49999618530273 14.49433040618896 38.49999618530273 16.875 C 38.49999618530273 19.25567054748535 37.92911529541016 21.5595703125 36.80320739746094 23.72270011901855 C 35.7380256652832 25.7691593170166 34.22452545166016 27.59766006469727 32.30475616455078 29.15740966796875 C 28.46116638183594 32.28020095825195 23.38096618652344 34 17.99999618530273 34 C 15.56243515014648 34 13.17374706268311 33.63927841186523 10.88027095794678 32.92620086669922 C 9.843160629272461 33.64066314697266 8.746576309204102 34.2519416809082 7.606456756591797 34.75040817260742 C 5.330506801605225 35.74546051025391 2.96057653427124 36.25 0.5624966025352478 36.25 Z M 26.99999618530273 16.625 C 26.86448669433594 16.625 26.74999618530273 16.7394905090332 26.74999618530273 16.875 C 26.74999618530273 17.0105094909668 26.86448669433594 17.125 26.99999618530273 17.125 C 27.13550758361816 17.125 27.24999618530273 17.0105094909668 27.24999618530273 16.875 C 27.24999618530273 16.7394905090332 27.13550758361816 16.625 26.99999618530273 16.625 Z M 17.99999618530273 16.625 C 17.86448669433594 16.625 17.74999618530273 16.7394905090332 17.74999618530273 16.875 C 17.74999618530273 17.0105094909668 17.86448669433594 17.125 17.99999618530273 17.125 C 18.13550758361816 17.125 18.24999618530273 17.0105094909668 18.24999618530273 16.875 C 18.24999618530273 16.7394905090332 18.13550758361816 16.625 17.99999618530273 16.625 Z M 8.999996185302734 16.625 C 8.864486694335938 16.625 8.749996185302734 16.7394905090332 8.749996185302734 16.875 C 8.749996185302734 17.0105094909668 8.864486694335938 17.125 8.999996185302734 17.125 C 9.135506629943848 17.125 9.249996185302734 17.0105094909668 9.249996185302734 16.875 C 9.249996185302734 16.7394905090332 9.135506629943848 16.625 8.999996185302734 16.625 Z"
                      stroke="none"
                    />
                    <path
                      d="M 17.99999618530273 2.25 C 8.057806015014648 2.25 -3.814697265625e-06 8.796089172363281 -3.814697265625e-06 16.875 C -3.814697265625e-06 20.36249923706055 1.504688262939453 23.55469131469727 4.007816314697266 26.06484031677246 C 3.12890625 29.60858917236328 0.1898384094238281 32.76562118530273 0.1546859741210938 32.80078125 C -3.814697265625e-06 32.96250152587891 -0.04218292236328125 33.20156097412109 0.04921722412109375 33.41249847412109 C 0.140625 33.62343978881836 0.3374977111816406 33.75 0.5624961853027344 33.75 C 5.224216461181641 33.75 8.718746185302734 31.51406097412109 10.44843673706055 30.13594055175781 C 12.74765586853027 31.00078010559082 15.29999732971191 31.5 17.99999618530273 31.5 C 27.94218635559082 31.5 35.99999618530273 24.95391082763672 35.99999618530273 16.875 C 35.99999618530273 8.796089172363281 27.94218635559082 2.25 17.99999618530273 2.25 M 8.999996185302734 19.125 C 7.755466461181641 19.125 6.749996185302734 18.11952972412109 6.749996185302734 16.875 C 6.749996185302734 15.63047027587891 7.755466461181641 14.625 8.999996185302734 14.625 C 10.24452590942383 14.625 11.24999618530273 15.63047027587891 11.24999618530273 16.875 C 11.24999618530273 18.11952972412109 10.24452590942383 19.125 8.999996185302734 19.125 M 17.99999618530273 19.125 C 16.75546646118164 19.125 15.74999618530273 18.11952972412109 15.74999618530273 16.875 C 15.74999618530273 15.63047027587891 16.75546646118164 14.625 17.99999618530273 14.625 C 19.24452590942383 14.625 20.24999618530273 15.63047027587891 20.24999618530273 16.875 C 20.24999618530273 18.11952972412109 19.24452590942383 19.125 17.99999618530273 19.125 M 26.99999618530273 19.125 C 25.75546646118164 19.125 24.74999618530273 18.11952972412109 24.74999618530273 16.875 C 24.74999618530273 15.63047027587891 25.75546646118164 14.625 26.99999618530273 14.625 C 28.24452590942383 14.625 29.24999618530273 15.63047027587891 29.24999618530273 16.875 C 29.24999618530273 18.11952972412109 28.24452590942383 19.125 26.99999618530273 19.125 M 17.99999618530273 -2.75 C 23.95332717895508 -2.75 29.59337615966797 -0.8314399719238281 33.88120651245117 2.652271270751953 C 36.06771850585938 4.428749084472656 37.79692840576172 6.521720886230469 39.02079772949219 8.873050689697266 C 40.3340950012207 11.39620018005371 40.99999618530273 14.08844947814941 40.99999618530273 16.875 C 40.99999618530273 19.66155052185059 40.3340950012207 22.35379981994629 39.02079772949219 24.87694931030273 C 37.79692840576172 27.22827911376953 36.06771850585938 29.32125091552734 33.88120651245117 31.09773063659668 C 29.59337615966797 34.58143997192383 23.95332717895508 36.5 17.99999618530273 36.5 C 15.71391868591309 36.5 13.46572875976563 36.21218109130859 11.2872314453125 35.64232635498047 C 10.42417335510254 36.17082977294922 9.52882194519043 36.63843154907227 8.607936859130859 37.04104995727539 C 6.014236450195313 38.17502975463867 3.307357788085938 38.75 0.5624961853027344 38.75 C -1.654544830322266 38.75 -3.656814575195313 37.43527984619141 -4.538543701171875 35.40058898925781 C -5.424884796142578 33.35500335693359 -5.012844085693359 30.99658966064453 -3.490550994873047 29.37843132019043 C -3.147705078125 29.00341606140137 -2.386672973632813 28.05732917785645 -1.750167846679688 26.95816802978516 C -2.437973022460938 25.97719955444336 -3.023773193359375 24.94540023803711 -3.502544403076172 23.87001037597656 C -4.496181488037109 21.63811874389648 -5.000003814697266 19.2846508026123 -5.000003814697266 16.875 C -5.000003814697266 14.08844947814941 -4.334102630615234 11.39620018005371 -3.020801544189453 8.873050689697266 C -1.796932220458984 6.521720886230469 -0.06772232055664063 4.428749084472656 2.118785858154297 2.652271270751953 C 6.4066162109375 -0.8314399719238281 12.04666709899902 -2.75 17.99999618530273 -2.75 Z"
                      stroke="none"
                      fill="#fff"
                    />
                  </g>
                </g>
              </svg>
            </span>
            <p className="verifyemailnotify">
              <span>A verification email has been sent to</span>
              <span>{this.state.encryptedEmail}</span>
            </p>
            <p className="veriflyemailLink">
              <span> Please click on the email to verify your</span>
              <span> email address.</span>
            </p>
            <p className="resendemail">
              <span>Didn't received the email?</span>
              <span>
                <a style={{ cursor: "pointer" }} onClick={this.handleResend}>
                  Resend Email
                </a>
              </span>
            </p>
            <p className="resendemail">
              <span>Home page</span>
              <span>
                <a style={{ cursor: "pointer" }} onClick={() => { this.props.history.push('/')}}>
                  click here
                </a>
              </span>
            </p>
          </div>
        </div>
      </div>
    );
  }
}

export default EmailVerificationCode;
